---
- name: Set Facts
  hosts: localhost
  connection: local
  vars_files:
  - login-creds.yml
  tasks:
  - include_tasks: setup-test.yml
  - set_fact:
      ignore_differences:
        metadata:
          annotations:
            kubectl.kubernetes.io/last-applied-configuration: ''
          creationTimestamp: null
          generation: 0
        spec:
          template:
            metadata:
              creationTimestamp: null

- name: Setup Project
  hosts: localhost
  connection: local
  vars:
    openshift_cluster_content:
    - object: projectrequest
      content:
      - name: test-project
        template: "resources/test-project.yml.j2"
        params: "resources/project/params"


  roles:
  - openshift-applier

- name: Test Provision
  hosts: localhost
  connection: local
  vars:
  roles:
  - role: openshift-applier 
    vars:
      openshift_cluster_content:
      - object: deploymentconfig
        content:
        - name: test-deploymentconfig
          template: "resources/deploymentconfig/template.yml"
          params: "resources/deploymentconfig/params1"
          namespace: provision-test
      ansible_connection: local


- name: Delete Provision
  hosts: localhost
  connection: local
  vars: 
    openshift_cluster_content:
    - object: deploymentconfig
      content:
      - name: test-deploymentconfig
        template: "resources/deploymentconfig/template.yml"
        params: "resources/deploymentconfig/params1"
        namespace: provision-test
        template_action: delete
    ansible_connection: local

  roles:
  - role: openshift-applier
     
